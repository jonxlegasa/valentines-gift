import{a as ae,f as he}from"./NcohxHJ3.js";import{i as xe}from"./DL-LV2aR.js";import{o as cn,c as Wn}from"./QKvlJIKN.js";import{as as Ln,aG as jn,y as Te,t as I,b3 as N,b4 as zn,Q as be,A as we,B as qe,V as ye,v as E,C as ln,D as Ce,j as Fn,aQ as Ze}from"./D6id5OkL.js";import{p as y,b as ke}from"./Dd0uHKTZ.js";import{s as Pe,e as Gn,a as Vn,i as Zn,C as Qn,S as Un}from"./CG02VQHH.js";import{e as Qe}from"./BoIuIueb.js";import{s as Xn}from"./weeuRzHt.js";function w(e,n,o){var t=jn(e,n);t&&t.set&&(e[n]=o,Ln(()=>{e[n]=null}))}const Yn=["white","black"],De=["a","b","c","d","e","f","g","h"],Ne=["1","2","3","4","5","6","7","8"],$n=[...Ne].reverse(),Ee=Array.prototype.concat(...De.map(e=>Ne.map(n=>e+n))),B=e=>Ee[8*e[0]+e[1]],S=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],an=Ee.map(S);function eo(e){let n;const o=()=>(n===void 0&&(n=e()),n);return o.clear=()=>{n=void 0},o}const no=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const n=performance.now()-e;return e=void 0,n}}},Ae=e=>e==="white"?"black":"white",te=(e,n)=>{const o=e[0]-n[0],t=e[1]-n[1];return o*o+t*t},Se=(e,n)=>e.role===n.role&&e.color===n.color,ie=e=>(n,o)=>[(o?n[0]:7-n[0])*e.width/8,(o?7-n[1]:n[1])*e.height/8],j=(e,n)=>{e.style.transform=`translate(${n[0]}px,${n[1]}px)`},dn=(e,n,o=1)=>{e.style.transform=`translate(${n[0]}px,${n[1]}px) scale(${o})`},Ke=(e,n)=>{e.style.visibility=n?"visible":"hidden"},$=e=>{var n;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((n=e.targetTouches)===null||n===void 0)&&n[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},un=e=>e.buttons===2||e.button===2,G=(e,n)=>{const o=document.createElement(e);return n&&(o.className=n),o};function fn(e,n,o){const t=S(e);return n||(t[0]=7-t[0],t[1]=7-t[1]),[o.left+o.width*t[0]/8+o.width/16,o.top+o.height*(7-t[1])/8+o.height/16]}const Y=(e,n)=>Math.abs(e-n),oo=e=>(n,o,t,i)=>Y(n,t)<2&&(e==="white"?i===o+1||o<=1&&i===o+2&&n===t:i===o-1||o>=6&&i===o-2&&n===t),hn=(e,n,o,t)=>{const i=Y(e,o),r=Y(n,t);return i===1&&r===2||i===2&&r===1},gn=(e,n,o,t)=>Y(e,o)===Y(n,t),pn=(e,n,o,t)=>e===o||n===t,mn=(e,n,o,t)=>gn(e,n,o,t)||pn(e,n,o,t),to=(e,n,o)=>(t,i,r,s)=>Y(t,r)<2&&Y(i,s)<2||o&&i===s&&i===(e==="white"?0:7)&&(t===4&&(r===2&&n.includes(0)||r===6&&n.includes(7))||n.includes(r));function io(e,n){const o=n==="white"?"1":"8",t=[];for(const[i,r]of e)i[1]===o&&r.color===n&&r.role==="rook"&&t.push(S(i)[0]);return t}function vn(e,n,o){const t=e.get(n);if(!t)return[];const i=S(n),r=t.role,s=r==="pawn"?oo(t.color):r==="knight"?hn:r==="bishop"?gn:r==="rook"?pn:r==="queen"?mn:to(t.color,io(e,t.color),o);return an.filter(c=>(i[0]!==c[0]||i[1]!==c[1])&&s(i[0],i[1],c[0],c[1])).map(B)}function A(e,...n){e&&setTimeout(()=>e(...n),1)}function ro(e){e.orientation=Ae(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function so(e,n){for(const[o,t]of n)t?e.pieces.set(o,t):e.pieces.delete(o)}function co(e,n){if(e.check=void 0,n===!0&&(n=e.turnColor),n)for(const[o,t]of e.pieces)t.role==="king"&&t.color===n&&(e.check=o)}function lo(e,n,o,t){Q(e),e.premovable.current=[n,o],A(e.premovable.events.set,n,o,t)}function Z(e){e.premovable.current&&(e.premovable.current=void 0,A(e.premovable.events.unset))}function ao(e,n,o){Z(e),e.predroppable.current={role:n,key:o},A(e.predroppable.events.set,n,o)}function Q(e){const n=e.predroppable;n.current&&(n.current=void 0,A(n.events.unset))}function uo(e,n,o){if(!e.autoCastle)return!1;const t=e.pieces.get(n);if(!t||t.role!=="king")return!1;const i=S(n),r=S(o);if(i[1]!==0&&i[1]!==7||i[1]!==r[1])return!1;i[0]===4&&!e.pieces.has(o)&&(r[0]===6?o=B([7,r[1]]):r[0]===2&&(o=B([0,r[1]])));const s=e.pieces.get(o);return!s||s.color!==t.color||s.role!=="rook"?!1:(e.pieces.delete(n),e.pieces.delete(o),i[0]<r[0]?(e.pieces.set(B([6,r[1]]),t),e.pieces.set(B([5,r[1]]),s)):(e.pieces.set(B([2,r[1]]),t),e.pieces.set(B([3,r[1]]),s)),!0)}function bn(e,n,o){const t=e.pieces.get(n),i=e.pieces.get(o);if(n===o||!t)return!1;const r=i&&i.color!==t.color?i:void 0;return o===e.selected&&H(e),A(e.events.move,n,o,r),uo(e,n,o)||(e.pieces.set(o,t),e.pieces.delete(n)),e.lastMove=[n,o],e.check=void 0,A(e.events.change),r||!0}function Ie(e,n,o,t){if(e.pieces.has(o))if(t)e.pieces.delete(o);else return!1;return A(e.events.dropNewPiece,n,o),e.pieces.set(o,n),e.lastMove=[o],e.check=void 0,A(e.events.change),e.movable.dests=void 0,e.turnColor=Ae(e.turnColor),!0}function wn(e,n,o){const t=bn(e,n,o);return t&&(e.movable.dests=void 0,e.turnColor=Ae(e.turnColor),e.animation.current=void 0),t}function yn(e,n,o){if(Je(e,n,o)){const t=wn(e,n,o);if(t){const i=e.hold.stop();H(e);const r={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return t!==!0&&(r.captured=t),A(e.movable.events.after,n,o,r),!0}}else if(ho(e,n,o))return lo(e,n,o,{ctrlKey:e.stats.ctrlKey}),H(e),!0;return H(e),!1}function Cn(e,n,o,t){const i=e.pieces.get(n);i&&(fo(e,n,o)||t)?(e.pieces.delete(n),Ie(e,i,o,t),A(e.movable.events.afterNewPiece,i.role,o,{premove:!1,predrop:!1})):i&&go(e,n,o)?ao(e,i.role,o):(Z(e),Q(e)),e.pieces.delete(n),H(e)}function Me(e,n,o){if(A(e.events.select,n),e.selected){if(e.selected===n&&!e.draggable.enabled){H(e),e.hold.cancel();return}else if((e.selectable.enabled||o)&&e.selected!==n&&yn(e,e.selected,n)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(Pn(e,n)||Re(e,n))&&(kn(e,n),e.hold.start())}function kn(e,n){e.selected=n,Re(e,n)?e.premovable.customDests||(e.premovable.dests=vn(e.pieces,n,e.premovable.castle)):e.premovable.dests=void 0}function H(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function Pn(e,n){const o=e.pieces.get(n);return!!o&&(e.movable.color==="both"||e.movable.color===o.color&&e.turnColor===o.color)}const Je=(e,n,o)=>{var t,i;return n!==o&&Pn(e,n)&&(e.movable.free||!!(!((i=(t=e.movable.dests)===null||t===void 0?void 0:t.get(n))===null||i===void 0)&&i.includes(o)))};function fo(e,n,o){const t=e.pieces.get(n);return!!t&&(n===o||!e.pieces.has(o))&&(e.movable.color==="both"||e.movable.color===t.color&&e.turnColor===t.color)}function Re(e,n){const o=e.pieces.get(n);return!!o&&e.premovable.enabled&&e.movable.color===o.color&&e.turnColor!==o.color}function ho(e,n,o){var t,i;const r=(i=(t=e.premovable.customDests)===null||t===void 0?void 0:t.get(n))!==null&&i!==void 0?i:vn(e.pieces,n,e.premovable.castle);return n!==o&&Re(e,n)&&r.includes(o)}function go(e,n,o){const t=e.pieces.get(n),i=e.pieces.get(o);return!!t&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&(t.role!=="pawn"||o[1]!=="1"&&o[1]!=="8")&&e.movable.color===t.color&&e.turnColor!==t.color}function po(e,n){const o=e.pieces.get(n);return!!o&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===o.color&&(e.turnColor===o.color||e.premovable.enabled))}function mo(e){const n=e.premovable.current;if(!n)return!1;const o=n[0],t=n[1];let i=!1;if(Je(e,o,t)){const r=wn(e,o,t);if(r){const s={premove:!0};r!==!0&&(s.captured=r),A(e.movable.events.after,o,t,s),i=!0}}return Z(e),i}function vo(e,n){const o=e.predroppable.current;let t=!1;if(!o)return!1;if(n(o)){const i={role:o.role,color:e.movable.color};Ie(e,i,o.key)&&(A(e.movable.events.afterNewPiece,o.role,o.key,{premove:!1,predrop:!0}),t=!0)}return Q(e),t}function Be(e){Z(e),Q(e),H(e)}function Ue(e){e.movable.color=e.movable.dests=e.animation.current=void 0,Be(e)}function ee(e,n,o){let t=Math.floor(8*(e[0]-o.left)/o.width);n||(t=7-t);let i=7-Math.floor(8*(e[1]-o.top)/o.height);return n||(i=7-i),t>=0&&t<8&&i>=0&&i<8?B([t,i]):void 0}function bo(e,n,o,t){const i=S(e),r=an.filter(l=>mn(i[0],i[1],l[0],l[1])||hn(i[0],i[1],l[0],l[1])),c=r.map(l=>fn(B(l),o,t)).map(l=>te(n,l)),[,a]=c.reduce((l,f,d)=>l[0]<f?l:[f,d],[c[0],0]);return B(r[a])}const K=e=>e.orientation==="white",Sn="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",wo={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},yo={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function Mn(e){e==="start"&&(e=Sn);const n=new Map;let o=7,t=0;for(const i of e)switch(i){case" ":case"[":return n;case"/":if(--o,o<0)return n;t=0;break;case"~":{const r=n.get(B([t-1,o]));r&&(r.promoted=!0);break}default:{const r=i.charCodeAt(0);if(r<57)t+=r-48;else{const s=i.toLowerCase();n.set(B([t,o]),{role:wo[s],color:i===s?"black":"white"}),++t}}}return n}function Co(e){return $n.map(n=>De.map(o=>{const t=e.get(o+n);if(t){let i=yo[t.role];return t.color==="white"&&(i=i.toUpperCase()),t.promoted&&(i+="~"),i}else return"1"}).join("")).join("/").replace(/1{2,}/g,n=>n.length.toString())}function _n(e,n){n.animation&&(He(e.animation,n.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function On(e,n){var o,t,i;if(!((o=n.movable)===null||o===void 0)&&o.dests&&(e.movable.dests=void 0),!((t=n.drawable)===null||t===void 0)&&t.autoShapes&&(e.drawable.autoShapes=[]),He(e,n),n.fen&&(e.pieces=Mn(n.fen),e.drawable.shapes=((i=n.drawable)===null||i===void 0?void 0:i.shapes)||[]),"check"in n&&co(e,n.check||!1),"lastMove"in n&&!n.lastMove?e.lastMove=void 0:n.lastMove&&(e.lastMove=n.lastMove),e.selected&&kn(e,e.selected),_n(e,n),!e.movable.rookCastle&&e.movable.dests){const r=e.movable.color==="white"?"1":"8",s="e"+r,c=e.movable.dests.get(s),a=e.pieces.get(s);if(!c||!a||a.role!=="king")return;e.movable.dests.set(s,c.filter(l=>!(l==="a"+r&&c.includes("c"+r))&&!(l==="h"+r&&c.includes("g"+r))))}}function He(e,n){for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(Object.prototype.hasOwnProperty.call(e,o)&&Xe(e[o])&&Xe(n[o])?He(e[o],n[o]):e[o]=n[o])}function Xe(e){if(typeof e!="object"||e===null)return!1;const n=Object.getPrototypeOf(e);return n===Object.prototype||n===null}const X=(e,n)=>n.animation.enabled?So(e,n):V(e,n);function V(e,n){const o=e(n);return n.dom.redraw(),o}const pe=(e,n)=>({key:e,pos:S(e),piece:n}),ko=(e,n)=>n.sort((o,t)=>te(e.pos,o.pos)-te(e.pos,t.pos))[0];function Po(e,n){const o=new Map,t=[],i=new Map,r=[],s=[],c=new Map;let a,l,f;for(const[d,C]of e)c.set(d,pe(d,C));for(const d of Ee)a=n.pieces.get(d),l=c.get(d),a?l?Se(a,l.piece)||(r.push(l),s.push(pe(d,a))):s.push(pe(d,a)):l&&r.push(l);for(const d of s)l=ko(d,r.filter(C=>Se(d.piece,C.piece))),l&&(f=[l.pos[0]-d.pos[0],l.pos[1]-d.pos[1]],o.set(d.key,f.concat(f)),t.push(l.key));for(const d of r)t.includes(d.key)||i.set(d.key,d.piece);return{anims:o,fadings:i}}function xn(e,n){const o=e.animation.current;if(o===void 0){e.dom.destroyed||e.dom.redrawNow();return}const t=1-(n-o.start)*o.frequency;if(t<=0)e.animation.current=void 0,e.dom.redrawNow();else{const i=Mo(t);for(const r of o.plan.anims.values())r[2]=r[0]*i,r[3]=r[1]*i;e.dom.redrawNow(!0),requestAnimationFrame((r=performance.now())=>xn(e,r))}}function So(e,n){const o=new Map(n.pieces),t=e(n),i=Po(o,n);if(i.anims.size||i.fadings.size){const r=n.animation.current&&n.animation.current.start;n.animation.current={start:performance.now(),frequency:1/n.animation.duration,plan:i},r||xn(n,performance.now())}else n.dom.redraw();return t}const Mo=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,_o=["green","red","blue","yellow"];function Oo(e,n){if(n.touches&&n.touches.length>1)return;n.stopPropagation(),n.preventDefault(),n.ctrlKey?H(e):Be(e);const o=$(n),t=ee(o,K(e),e.dom.bounds());t&&(e.drawable.current={orig:t,pos:o,brush:Do(n),snapToValidMove:e.drawable.defaultSnapToValidMove},Tn(e))}function Tn(e){requestAnimationFrame(()=>{const n=e.drawable.current;if(n){const o=ee(n.pos,K(e),e.dom.bounds());o||(n.snapToValidMove=!1);const t=n.snapToValidMove?bo(n.orig,n.pos,K(e),e.dom.bounds()):o;t!==n.mouseSq&&(n.mouseSq=t,n.dest=t!==n.orig?t:void 0,e.dom.redrawNow()),Tn(e)}})}function xo(e,n){e.drawable.current&&(e.drawable.current.pos=$(n))}function To(e){const n=e.drawable.current;n&&(n.mouseSq&&No(e.drawable,n),qn(e))}function qn(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function qo(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Dn(e.drawable))}function Do(e){var n;const o=(e.shiftKey||e.ctrlKey)&&un(e),t=e.altKey||e.metaKey||((n=e.getModifierState)===null||n===void 0?void 0:n.call(e,"AltGraph"));return _o[(o?1:0)+(t?2:0)]}function No(e,n){const o=i=>i.orig===n.orig&&i.dest===n.dest,t=e.shapes.find(o);t&&(e.shapes=e.shapes.filter(i=>!o(i))),(!t||t.brush!==n.brush)&&e.shapes.push({orig:n.orig,dest:n.dest,brush:n.brush}),Dn(e)}function Dn(e){e.onChange&&e.onChange(e.shapes)}function Eo(e,n){if(!(e.trustAllEvents||n.isTrusted)||n.button!==void 0&&n.button!==0||n.touches&&n.touches.length>1)return;const o=e.dom.bounds(),t=$(n),i=ee(t,K(e),o);if(!i)return;const r=e.pieces.get(i),s=e.selected;if(!s&&e.drawable.enabled&&(e.drawable.eraseOnClick||!r||r.color!==e.turnColor)&&qo(e),n.cancelable!==!1&&(!n.touches||e.blockTouchScroll||r||s||Ao(e,t)))n.preventDefault();else if(n.touches)return;const c=!!e.premovable.current,a=!!e.predroppable.current;e.stats.ctrlKey=n.ctrlKey,e.selected&&Je(e,e.selected,i)?X(d=>Me(d,i),e):Me(e,i);const l=e.selected===i,f=En(e,i);if(r&&f&&l&&po(e,i)){e.draggable.current={orig:i,piece:r,origPos:t,pos:t,started:e.draggable.autoDistance&&e.stats.dragged,element:f,previouslySelected:s,originTarget:n.target,keyHasChanged:!1},f.cgDragging=!0,f.classList.add("dragging");const d=e.dom.elements.ghost;d&&(d.className=`ghost ${r.color} ${r.role}`,j(d,ie(o)(S(i),K(e))),Ke(d,!0)),We(e)}else c&&Z(e),a&&Q(e);e.dom.redraw()}function Ao(e,n){const o=K(e),t=e.dom.bounds(),i=Math.pow(t.width/8,2);for(const r of e.pieces.keys()){const s=fn(r,o,t);if(te(s,n)<=i)return!0}return!1}function Ko(e,n,o,t){e.pieces.set("a0",n),e.dom.redraw();const r=$(o);e.draggable.current={orig:"a0",piece:n,origPos:r,pos:r,started:!0,element:()=>En(e,"a0"),originTarget:o.target,newPiece:!0,force:!!t,keyHasChanged:!1},We(e)}function We(e){requestAnimationFrame(()=>{var n;const o=e.draggable.current;if(!o)return;!((n=e.animation.current)===null||n===void 0)&&n.plan.anims.has(o.orig)&&(e.animation.current=void 0);const t=e.pieces.get(o.orig);if(!t||!Se(t,o.piece))de(e);else if(!o.started&&te(o.pos,o.origPos)>=Math.pow(e.draggable.distance,2)&&(o.started=!0),o.started){if(typeof o.element=="function"){const r=o.element();if(!r)return;r.cgDragging=!0,r.classList.add("dragging"),o.element=r}const i=e.dom.bounds();j(o.element,[o.pos[0]-i.left-i.width/16,o.pos[1]-i.top-i.height/16]),o.keyHasChanged||(o.keyHasChanged=o.orig!==ee(o.pos,K(e),i))}We(e)})}function Io(e,n){e.draggable.current&&(!n.touches||n.touches.length<2)&&(e.draggable.current.pos=$(n))}function Jo(e,n){const o=e.draggable.current;if(!o)return;if(n.type==="touchend"&&n.cancelable!==!1&&n.preventDefault(),n.type==="touchend"&&o.originTarget!==n.target&&!o.newPiece){e.draggable.current=void 0;return}Z(e),Q(e);const t=$(n)||o.pos,i=ee(t,K(e),e.dom.bounds());i&&o.started&&o.orig!==i?o.newPiece?Cn(e,o.orig,i,o.force):(e.stats.ctrlKey=n.ctrlKey,yn(e,o.orig,i)&&(e.stats.dragged=!0)):o.newPiece?e.pieces.delete(o.orig):e.draggable.deleteOnDropOff&&!i&&(e.pieces.delete(o.orig),A(e.events.change)),(o.orig===o.previouslySelected||o.keyHasChanged)&&(o.orig===i||!i)?H(e):e.selectable.enabled||H(e),Nn(e),e.draggable.current=void 0,e.dom.redraw()}function de(e){const n=e.draggable.current;n&&(n.newPiece&&e.pieces.delete(n.orig),e.draggable.current=void 0,H(e),Nn(e),e.dom.redraw())}function Nn(e){const n=e.dom.elements;n.ghost&&Ke(n.ghost,!1)}function En(e,n){let o=e.dom.elements.board.firstChild;for(;o;){if(o.cgKey===n&&o.tagName==="PIECE")return o;o=o.nextSibling}}function Ro(e,n){e.exploding={stage:1,keys:n},e.dom.redraw(),setTimeout(()=>{Ye(e,2),setTimeout(()=>Ye(e,void 0),120)},120)}function Ye(e,n){e.exploding&&(n?e.exploding.stage=n:e.exploding=void 0,e.dom.redraw())}function Bo(e,n){function o(){ro(e),n()}return{set(t){t.orientation&&t.orientation!==e.orientation&&o(),_n(e,t),(t.fen?X:V)(i=>On(i,t),e)},state:e,getFen:()=>Co(e.pieces),toggleOrientation:o,setPieces(t){X(i=>so(i,t),e)},selectSquare(t,i){t?X(r=>Me(r,t,i),e):e.selected&&(H(e),e.dom.redraw())},move(t,i){X(r=>bn(r,t,i),e)},newPiece(t,i){X(r=>Ie(r,t,i),e)},playPremove(){if(e.premovable.current){if(X(mo,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const i=vo(e,t);return e.dom.redraw(),i}return!1},cancelPremove(){V(Z,e)},cancelPredrop(){V(Q,e)},cancelMove(){V(t=>{Be(t),de(t)},e)},stop(){V(t=>{Ue(t),de(t)},e)},explode(t){Ro(e,t)},setAutoShapes(t){V(i=>i.drawable.autoShapes=t,e)},setShapes(t){V(i=>i.drawable.shapes=t,e)},getKeyAtDomPos(t){return ee(t,K(e),e.dom.bounds())},redrawAll:n,dragNewPiece(t,i,r){Ko(e,t,i,r)},destroy(){Ue(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function Ho(){return{pieces:Mn(Sn),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purp",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},hilite:{key:"hilite",color:"#fff",opacity:1,lineWidth:1}},prevSvgHash:""},hold:no()}}function Wo(){const e=O("defs"),n=q(O("filter"),{id:"cg-filter-blur"});return n.appendChild(q(O("feGaussianBlur"),{stdDeviation:"0.022"})),e.appendChild(n),e}function Lo(e,n,o){var t;const i=e.drawable,r=i.current,s=r&&r.mouseSq?r:void 0,c=new Map,a=e.dom.bounds(),l=i.autoShapes.filter(m=>!m.piece);for(const m of i.shapes.concat(l).concat(s?[s]:[])){if(!m.dest)continue;const h=(t=c.get(m.dest))!==null&&t!==void 0?t:new Set,u=fe(ue(S(m.orig),e.orientation),a),g=fe(ue(S(m.dest),e.orientation),a);h.add(Oe(u,g)),c.set(m.dest,h)}const f=i.shapes.concat(l).map(m=>({shape:m,current:!1,hash:$e(m,_e(m.dest,c),!1,a)}));s&&f.push({shape:s,current:!0,hash:$e(s,_e(s.dest,c),!0,a)});const d=f.map(m=>m.hash).join(";");if(d===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=d;const C=n.querySelector("defs");jo(i,f,C),zo(f,n.querySelector("g"),o.querySelector("g"),m=>Vo(e,m,i.brushes,c,a))}function jo(e,n,o){var t;const i=new Map;let r;for(const a of n)a.shape.dest&&(r=An(e.brushes[a.shape.brush],a.shape.modifiers),!((t=a.shape.modifiers)===null||t===void 0)&&t.hilite&&i.set("hilite",e.brushes.hilite),i.set(r.key,r));const s=new Set;let c=o.firstElementChild;for(;c;)s.add(c.getAttribute("cgKey")),c=c.nextElementSibling;for(const[a,l]of i.entries())s.has(a)||o.appendChild(Uo(l))}function zo(e,n,o,t){const i=new Map;for(const r of e)i.set(r.hash,!1);for(const r of[n,o]){const s=[];let c=r.firstElementChild,a;for(;c;)a=c.getAttribute("cgHash"),i.has(a)?i.set(a,!0):s.push(c),c=c.nextElementSibling;for(const l of s)r.removeChild(l)}for(const r of e.filter(s=>!i.get(s.hash)))for(const s of t(r))s.isCustom?o.appendChild(s.el):n.appendChild(s.el)}function $e({orig:e,dest:n,brush:o,piece:t,modifiers:i,customSvg:r,label:s},c,a,l){return[l.width,l.height,a,e,n,o,c&&"-",t&&Fo(t),i&&Go(i),r&&`custom-${en(r)}`,s&&`label-${en(s.text)}`].filter(f=>f).join(",")}function Fo(e){return[e.color,e.role,e.scale].filter(n=>n).join(",")}function Go(e){var n;return[e.lineWidth,e.hilite&&"*",(n=e.overlayCustomSvg)===null||n===void 0?void 0:n[0]].filter(o=>o).join(",")}function en(e){let n=0;for(let o=0;o<e.length;o++)n=(n<<5)-n+e.charCodeAt(o)>>>0;return n.toString()}function Vo(e,{shape:n,current:o,hash:t},i,r,s){var c,a,l;const f=fe(ue(S(n.orig),e.orientation),s),d=n.dest?fe(ue(S(n.dest),e.orientation),s):f,C=An(i[n.brush],n.modifiers),m=r.get(n.dest),h=[];if(!n.customSvg||!((c=n.modifiers)===null||c===void 0)&&c.overlayCustomSvg){const u=q(O("g"),{cgHash:t});h.push({el:u}),f[0]!==d[0]||f[1]!==d[1]?u.appendChild(Qo(n,C,f,d,o,_e(n.dest,r))):u.appendChild(Zo(i[n.brush],f,o,s)),n.label&&h.push({el:Xo(n.label.text,C.color,t,f,d,m),isCustom:!0})}if(n.customSvg){const u=(l=(a=n.modifiers)===null||a===void 0?void 0:a.overlayCustomSvg)!==null&&l!==void 0?l:"orig",[g,M]=u==="label"?In(f,d,m):u==="dest"?d:f,p=q(O("g"),{transform:`translate(${g},${M})`,cgHash:t});p.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${n.customSvg}</svg>`,h.push({el:p,isCustom:!0})}return h}function Zo(e,n,o,t){const i=Yo(),r=(t.width+t.height)/(4*Math.max(t.width,t.height));return q(O("circle"),{stroke:e.color,"stroke-width":i[o?0:1],fill:"none",opacity:Kn(e,o),cx:n[0],cy:n[1],r:r-i[1]/2})}function Qo(e,n,o,t,i,r){var s;function c(f){var d;const C=et(r&&!i),m=t[0]-o[0],h=t[1]-o[1],u=Math.atan2(h,m),g=Math.cos(u)*C,M=Math.sin(u)*C;return q(O("line"),{stroke:f?"white":n.color,"stroke-width":$o(n,i)+(f?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${f?"hilite":n.key})`,opacity:!((d=e.modifiers)===null||d===void 0)&&d.hilite?1:Kn(n,i),x1:o[0],y1:o[1],x2:t[0]-g,y2:t[1]-M})}if(!(!((s=e.modifiers)===null||s===void 0)&&s.hilite))return c(!1);const a=O("g"),l=q(O("g"),{filter:"url(#cg-filter-blur)"});return l.appendChild(nt(o,t)),l.appendChild(c(!0)),a.appendChild(l),a.appendChild(c(!1)),a}function Uo(e){const n=q(O("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key==="hilite"?1.86:2.05,refY:2});return n.appendChild(q(O("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),n.setAttribute("cgKey",e.key),n}function Xo(e,n,o,t,i,r){const c=.4*.8**e.length,[a,l]=In(t,i,r),f=q(O("g"),{transform:`translate(${a+.5},${l+.5})`,cgHash:o});f.appendChild(q(O("circle"),{r:.4/2,"fill-opacity":.8,"stroke-opacity":.7,"stroke-width":.03,fill:n,stroke:"white"}));const d=q(O("text"),{"font-size":c,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:c*.34,innerHTML:e});return d.innerHTML=e,f.appendChild(d),f}function ue(e,n){return n==="white"?e:[7-e[0],7-e[1]]}function _e(e,n){return(e&&n.has(e)&&n.get(e).size>1)===!0}function O(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function q(e,n){for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.setAttribute(o,n[o]);return e}function An(e,n){return n?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(n.lineWidth||e.lineWidth),key:[e.key,n.lineWidth].filter(o=>o).join("")}:e}function Yo(){return[3/64,4/64]}function $o(e,n){return(e.lineWidth||10)*(n?.85:1)/64}function Kn(e,n){return(e.opacity||1)*(n?.9:1)}function et(e){return(e?20:10)/64}function fe(e,n){const o=Math.min(1,n.width/n.height),t=Math.min(1,n.height/n.width);return[(e[0]-3.5)*o,(3.5-e[1])*t]}function nt(e,n){const o={from:[Math.floor(Math.min(e[0],n[0])),Math.floor(Math.min(e[1],n[1]))],to:[Math.ceil(Math.max(e[0],n[0])),Math.ceil(Math.max(e[1],n[1]))]};return q(O("rect"),{x:o.from[0],y:o.from[1],width:o.to[0]-o.from[0],height:o.to[1]-o.from[1],fill:"none",stroke:"none"})}function Oe(e,n,o=!0){const t=Math.atan2(n[1]-e[1],n[0]-e[0])+Math.PI;return o?(Math.round(t*8/Math.PI)+16)%16:t}function ot(e,n){return Math.sqrt([e[0]-n[0],e[1]-n[1]].reduce((o,t)=>o+t*t,0))}function In(e,n,o){let t=ot(e,n);if(t===0)return[.5+e[0],.5+e[1]];const i=Oe(e,n,!1);if(o&&(t-=33/64,o.size>1)){t-=10/64;const r=Oe(e,n);(o.has((r+1)%16)||o.has((r+15)%16))&&r&1&&(t-=.4)}return[e[0]-Math.cos(i)*t,e[1]-Math.sin(i)*t]}function tt(e,n){e.innerHTML="",e.classList.add("cg-wrap");for(const a of Yn)e.classList.toggle("orientation-"+a,n.orientation===a);e.classList.toggle("manipulable",!n.viewOnly);const o=G("cg-container");e.appendChild(o);const t=G("cg-board");o.appendChild(t);let i,r,s;if(n.drawable.visible&&(i=q(O("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(Wo()),i.appendChild(O("g")),r=q(O("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),r.appendChild(O("g")),s=G("cg-auto-pieces"),o.appendChild(i),o.appendChild(r),o.appendChild(s)),n.coordinates){const a=n.orientation==="black"?" black":"",l=n.ranksPosition==="left"?" left":"";o.appendChild(nn(Ne,"ranks"+a+l)),o.appendChild(nn(De,"files"+a))}let c;return n.draggable.enabled&&n.draggable.showGhost&&(c=G("piece","ghost"),Ke(c,!1),o.appendChild(c)),{board:t,container:o,wrap:e,ghost:c,svg:i,customSvg:r,autoPieces:s}}function nn(e,n){const o=G("coords",n);let t;for(const i of e)t=G("coord"),t.textContent=i,o.appendChild(t);return o}function it(e,n){if(!e.dropmode.active)return;Z(e),Q(e);const o=e.dropmode.piece;if(o){e.pieces.set("a0",o);const t=$(n),i=t&&ee(t,K(e),e.dom.bounds());i&&Cn(e,"a0",i)}e.dom.redraw()}function rt(e,n){const o=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(n).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&o.addEventListener("contextmenu",i=>i.preventDefault()),e.viewOnly)return;const t=ct(e);o.addEventListener("touchstart",t,{passive:!1}),o.addEventListener("mousedown",t,{passive:!1})}function st(e,n){const o=[];if("ResizeObserver"in window||o.push(ne(document.body,"chessground.resize",n)),!e.viewOnly){const t=on(e,Io,xo),i=on(e,Jo,To);for(const s of["touchmove","mousemove"])o.push(ne(document,s,t));for(const s of["touchend","mouseup"])o.push(ne(document,s,i));const r=()=>e.dom.bounds.clear();o.push(ne(document,"scroll",r,{capture:!0,passive:!0})),o.push(ne(window,"resize",r,{passive:!0}))}return()=>o.forEach(t=>t())}function ne(e,n,o,t){return e.addEventListener(n,o,t),()=>e.removeEventListener(n,o,t)}const ct=e=>n=>{e.draggable.current?de(e):e.drawable.current?qn(e):n.shiftKey||un(n)?e.drawable.enabled&&Oo(e,n):e.viewOnly||(e.dropmode.active?it(e,n):Eo(e,n))},on=(e,n,o)=>t=>{e.drawable.current?e.drawable.enabled&&o(e,t):e.viewOnly||n(e,t)};function lt(e){const n=K(e),o=ie(e.dom.bounds()),t=e.dom.elements.board,i=e.pieces,r=e.animation.current,s=r?r.plan.anims:new Map,c=r?r.plan.fadings:new Map,a=e.draggable.current,l=dt(e),f=new Set,d=new Set,C=new Map,m=new Map;let h,u,g,M,p,v,D,_,W,z;for(u=t.firstChild;u;){if(h=u.cgKey,Jn(u))if(g=i.get(h),p=s.get(h),v=c.get(h),M=u.cgPiece,u.cgDragging&&(!a||a.orig!==h)&&(u.classList.remove("dragging"),j(u,o(S(h),n)),u.cgDragging=!1),!v&&u.cgFading&&(u.cgFading=!1,u.classList.remove("fading")),g){if(p&&u.cgAnimating&&M===oe(g)){const k=S(h);k[0]+=p[2],k[1]+=p[3],u.classList.add("anim"),j(u,o(k,n))}else u.cgAnimating&&(u.cgAnimating=!1,u.classList.remove("anim"),j(u,o(S(h),n)),e.addPieceZIndex&&(u.style.zIndex=me(S(h),n)));M===oe(g)&&(!v||!u.cgFading)?f.add(h):v&&M===oe(v)?(u.classList.add("fading"),u.cgFading=!0):ve(C,M,u)}else ve(C,M,u);else if(Rn(u)){const k=u.className;l.get(h)===k?d.add(h):ve(m,k,u)}u=u.nextSibling}for(const[k,L]of l)if(!d.has(k)){W=m.get(L),z=W&&W.pop();const x=o(S(k),n);if(z)z.cgKey=k,j(z,x);else{const T=G("square",L);T.cgKey=k,j(T,x),t.insertBefore(T,t.firstChild)}}for(const[k,L]of i)if(p=s.get(k),!f.has(k))if(D=C.get(oe(L)),_=D&&D.pop(),_){_.cgKey=k,_.cgFading&&(_.classList.remove("fading"),_.cgFading=!1);const x=S(k);e.addPieceZIndex&&(_.style.zIndex=me(x,n)),p&&(_.cgAnimating=!0,_.classList.add("anim"),x[0]+=p[2],x[1]+=p[3]),j(_,o(x,n))}else{const x=oe(L),T=G("piece",x),J=S(k);T.cgPiece=x,T.cgKey=k,p&&(T.cgAnimating=!0,J[0]+=p[2],J[1]+=p[3]),j(T,o(J,n)),e.addPieceZIndex&&(T.style.zIndex=me(J,n)),t.appendChild(T)}for(const k of C.values())rn(e,k);for(const k of m.values())rn(e,k)}function at(e){const n=K(e),o=ie(e.dom.bounds());let t=e.dom.elements.board.firstChild;for(;t;)(Jn(t)&&!t.cgAnimating||Rn(t))&&j(t,o(S(t.cgKey),n)),t=t.nextSibling}function tn(e){var n,o;const t=e.dom.elements.wrap.getBoundingClientRect(),i=e.dom.elements.container,r=t.height/t.width,s=Math.floor(t.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,c=s*r;i.style.width=s+"px",i.style.height=c+"px",e.dom.bounds.clear(),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("--cg-width",s+"px"),(o=e.addDimensionsCssVarsTo)===null||o===void 0||o.style.setProperty("--cg-height",c+"px")}const Jn=e=>e.tagName==="PIECE",Rn=e=>e.tagName==="SQUARE";function rn(e,n){for(const o of n)e.dom.elements.board.removeChild(o)}function me(e,n){const t=e[1];return`${n?10-t:3+t}`}const oe=e=>`${e.color} ${e.role}`;function dt(e){var n,o,t;const i=new Map;if(e.lastMove&&e.highlight.lastMove)for(const c of e.lastMove)F(i,c,"last-move");if(e.check&&e.highlight.check&&F(i,e.check,"check"),e.selected&&(F(i,e.selected,"selected"),e.movable.showDests)){const c=(n=e.movable.dests)===null||n===void 0?void 0:n.get(e.selected);if(c)for(const l of c)F(i,l,"move-dest"+(e.pieces.has(l)?" oc":""));const a=(t=(o=e.premovable.customDests)===null||o===void 0?void 0:o.get(e.selected))!==null&&t!==void 0?t:e.premovable.dests;if(a)for(const l of a)F(i,l,"premove-dest"+(e.pieces.has(l)?" oc":""))}const r=e.premovable.current;if(r)for(const c of r)F(i,c,"current-premove");else e.predroppable.current&&F(i,e.predroppable.current.key,"current-premove");const s=e.exploding;if(s)for(const c of s.keys)F(i,c,"exploding"+s.stage);return e.highlight.custom&&e.highlight.custom.forEach((c,a)=>{F(i,a,c)}),i}function F(e,n,o){const t=e.get(n);t?e.set(n,`${t} ${o}`):e.set(n,o)}function ve(e,n,o){const t=e.get(n);t?t.push(o):e.set(n,[o])}function ut(e,n,o){const t=new Map,i=[];for(const c of e)t.set(c.hash,!1);let r=n.firstElementChild,s;for(;r;)s=r.getAttribute("cgHash"),t.has(s)?t.set(s,!0):i.push(r),r=r.nextElementSibling;for(const c of i)n.removeChild(c);for(const c of e)t.get(c.hash)||n.appendChild(o(c))}function ft(e,n){const t=e.drawable.autoShapes.filter(i=>i.piece).map(i=>({shape:i,hash:pt(i),current:!1}));ut(t,n,i=>gt(e,i,e.dom.bounds()))}function ht(e){var n;const o=K(e),t=ie(e.dom.bounds());let i=(n=e.dom.elements.autoPieces)===null||n===void 0?void 0:n.firstChild;for(;i;)dn(i,t(S(i.cgKey),o),i.cgScale),i=i.nextSibling}function gt(e,{shape:n,hash:o},t){var i,r,s;const c=n.orig,a=(i=n.piece)===null||i===void 0?void 0:i.role,l=(r=n.piece)===null||r===void 0?void 0:r.color,f=(s=n.piece)===null||s===void 0?void 0:s.scale,d=G("piece",`${a} ${l}`);return d.setAttribute("cgHash",o),d.cgKey=c,d.cgScale=f,dn(d,ie(t)(S(c),K(e)),f),d}const pt=e=>{var n,o,t;return[e.orig,(n=e.piece)===null||n===void 0?void 0:n.role,(o=e.piece)===null||o===void 0?void 0:o.color,(t=e.piece)===null||t===void 0?void 0:t.scale].join(",")};function mt(e,n){const o=Ho();On(o,n||{});function t(){const i="dom"in o?o.dom.unbind:void 0,r=tt(e,o),s=eo(()=>r.board.getBoundingClientRect()),c=f=>{lt(l),r.autoPieces&&ft(l,r.autoPieces),!f&&r.svg&&Lo(l,r.svg,r.customSvg)},a=()=>{tn(l),at(l),r.autoPieces&&ht(l)},l=o;return l.dom={elements:r,bounds:s,redraw:vt(c),redrawNow:c,unbind:i},l.drawable.prevSvgHash="",tn(l),c(!1),rt(l,a),i||(l.dom.unbind=st(l,a)),l.events.insert&&l.events.insert(r),l}return Bo(t(),t)}function vt(e){let n=!1;return()=>{n||(n=!0,requestAnimationFrame(()=>{e(),n=!1}))}}var bt=he("<div></div>");function wt(e,n){Te(n,!1);let o=y(n,"class",8,"cg-default-style"),t=y(n,"fen",8,void 0),i=y(n,"orientation",8,void 0),r=y(n,"turnColor",8,void 0),s=y(n,"check",8,void 0),c=y(n,"lastMove",8,void 0),a=y(n,"selected",8,void 0),l=y(n,"coordinates",8,void 0),f=y(n,"autoCastle",8,void 0),d=y(n,"viewOnly",8,void 0),C=y(n,"disableContextMenu",8,void 0),m=y(n,"addPieceZIndex",8,void 0),h=y(n,"addDimensionsCssVarsTo",8,void 0),u=y(n,"blockTouchScroll",8,void 0),g=y(n,"config",28,()=>({})),M=ye(),p;cn(async()=>{i()!==void 0&&g(g().orientation=i(),!0),t()!==void 0&&g(g().fen=t(),!0),r()!==void 0&&g(g().turnColor=r(),!0),s()!==void 0&&g(g().check=s(),!0),c()!==void 0&&g(g().lastMove=c(),!0),a()!==void 0&&g(g().selected=a(),!0),l()!==void 0&&g(g().coordinates=l(),!0),f()!==void 0&&g(g().autoCastle=f(),!0),d()!==void 0&&g(g().viewOnly=d(),!0),C()!==void 0&&g(g().disableContextMenu=C(),!0),m()!==void 0&&g(g().addPieceZIndex=m(),!0),h()!==void 0&&g(g().addDimensionsCssVarsTo=h(),!0),u()!==void 0&&g(g().blockTouchScroll=u(),!0),p=mt(I(M),g())});function v(P){p&&p.set(P)}function D(P){p.set(P)}function _(){return p.state}function W(){return p.getFen()}function z(){return p.toggleOrientation()}function k(P,U){return p.move(P,U)}function L(P){return p.setPieces(P)}function x(P,U){return p.selectSquare(P,U)}function T(P,U){return p.newPiece(P,U)}function J(){return p.playPremove()}function re(){p.cancelPremove()}function b(P){return p.playPredrop(P)}function se(){p.cancelPredrop()}function ce(){p.cancelMove()}function le(){p.stop()}function Le(P){p.explode(P)}function je(P){p.setShapes(P)}function ze(P){p.setAutoShapes(P)}function Fe(){return p.redrawAll()}function Ge(P,U,Hn){p.dragNewPiece(P,U,Hn)}function Ve(){return p.destroy()}N(()=>E(t()),()=>{v({fen:t()})}),N(()=>E(i()),()=>{v({orientation:i()})}),N(()=>E(r()),()=>{v({turnColor:r()})}),N(()=>E(s()),()=>{v({check:s()})}),N(()=>E(c()),()=>{v({lastMove:c()})}),N(()=>E(a()),()=>{v({selected:a()})}),N(()=>E(l()),()=>{v({coordinates:l()})}),N(()=>E(f()),()=>{v({autoCastle:f()})}),N(()=>E(d()),()=>{v({viewOnly:d()})}),N(()=>E(C()),()=>{v({disableContextMenu:C()})}),N(()=>E(m()),()=>{v({addPieceZIndex:m()})}),N(()=>E(h()),()=>{v({addDimensionsCssVarsTo:h()})}),N(()=>E(u()),()=>{v({blockTouchScroll:u()})}),N(()=>E(g()),()=>{v(g())}),zn();var Bn={set:D,getState:_,getFen:W,toggleOrientation:z,move:k,setPieces:L,selectSquare:x,newPiece:T,playPremove:J,cancelPremove:re,playPredrop:b,cancelPredrop:se,cancelMove:ce,stop:le,explode:Le,setShapes:je,setAutoShapes:ze,redrawAll:Fe,dragNewPiece:Ge,destroy:Ve};xe();var ge=bt();return ke(ge,P=>be(M,P),()=>I(M)),we(()=>Pe(ge,1,`cg-wrap ${o()??""}`,"svelte-bm6wpj")),ae(e,ge),w(n,"set",D),w(n,"getState",_),w(n,"getFen",W),w(n,"toggleOrientation",z),w(n,"move",k),w(n,"setPieces",L),w(n,"selectSquare",x),w(n,"newPiece",T),w(n,"playPremove",J),w(n,"cancelPremove",re),w(n,"playPredrop",b),w(n,"cancelPredrop",se),w(n,"cancelMove",ce),w(n,"stop",le),w(n,"explode",Le),w(n,"setShapes",je),w(n,"setAutoShapes",ze),w(n,"redrawAll",Fe),w(n,"dragNewPiece",Ge),w(n,"destroy",Ve),qe(Bn)}var yt=he('<div class="square svelte-8sorfg"><div role="button" tabindex="0"></div></div>'),Ct=he("<div></div>");function kt(e,n){Te(n,!1);let o=y(n,"square",8),t=y(n,"orientation",8,"w"),i=y(n,"callback",8),r=y(n,"class",24,()=>{});const s=100/8*(t()==="w"?d(o()):7-d(o())),c=o().charAt(1)==="8",a=!c,l=["q","n","r","b"],f={q:"queen",n:"knight",r:"rook",b:"bishop",p:"pawn",k:"king"};function d(h){return h.charCodeAt(0)-97}function C(h,u){(h.key==="Enter"||h.key===" ")&&i()(u)}xe();var m=Ct();Gn(m,5,()=>l,Zn,(h,u,g)=>{const M=Ze(()=>c&&t()==="w"||a&&t()==="b"),p=Ze(()=>I(M)?g*12.5:100-12.5*(g+1));var v=yt(),D=ln(v);let _;Ce(v),we(()=>{Vn(v,`margin-left:${s}%;margin-top:${I(p)??""}%;`),_=Pe(D,1,`piece ${I(u)??""}`,"svelte-8sorfg",_,{white:c,black:a}),Xn(D,"aria-label",`Promote to ${I(u),Fn(()=>f[I(u)])??""}`)}),Qe("click",D,()=>i()(I(u))),Qe("keydown",D,W=>C(W,I(u))),ae(h,v)}),Ce(m),we(()=>Pe(m,1,`dialog ${r()??""}`,"svelte-8sorfg")),ae(e,m),qe()}class R{cg;stateChangeCallback;promotionCallback;moveCallback;gameOverCallback;_orientation;engine;chessJS;gameIsOver=!1;initialised=!1;constructor(n,o="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",t=l=>{},i=async l=>"q",r=l=>{},s=l=>{},c="w",a=void 0){this.cg=n,this.stateChangeCallback=t,this.promotionCallback=i,this.moveCallback=r,this.gameOverCallback=s,this._orientation=c,this.engine=a,this.cg.set({fen:o,orientation:R._colorToCgColor(c),movable:{free:!1},premovable:{enabled:!1}}),this.chessJS=new Qn(o)}async init(){this.engine?(await this.engine.init(),this.load(this.chessJS.fen()),this._enginePlaysNextMove()&&this.playEngineMove()):this.load(this.chessJS.fen()),this.initialised=!0}load(n){let o;this.initialised&&this.engine?.isSearching()&&(o=this.engine.stopSearch()),this.chessJS.load(n),this._checkForGameOver(),this.cg.set({animation:{enabled:!1}});const t=R._colorToCgColor(this.chessJS.turn()),i=this._enginePlaysNextMove();this.cg.set({fen:n,turnColor:t,check:this.chessJS.inCheck(),lastMove:void 0,selected:void 0,movable:{free:!1,color:t,dests:i?new Map:this.possibleMovesDests(),events:{after:(r,s)=>{this._chessgroundMoveCallback(r,s)}}}}),this.cg.set({animation:{enabled:!0}}),this.initialised&&i&&(o?o.then(()=>{this.playEngineMove()}):this.playEngineMove()),this.stateChangeCallback(this)}async _chessgroundMoveCallback(n,o){if(n==="a0"||o==="a0")throw Error("invalid square");this.engine&&this.engine.isSearching()&&this.engine.stopSearch();let t;if(this._moveIsPromotion(n,o)){const r=await this.promotionCallback(o);t=this.chessJS.move({from:n,to:o,promotion:r})}else t=this.chessJS.move({from:n,to:o});const i=R._cjsMoveToMove(t);this._postMoveAdmin(i)}_moveIsPromotion(n,o){return this.chessJS.get(n).type==="p"&&(o.charAt(1)=="1"||o.charAt(1)=="8")}move(n){if(!this.initialised)throw new Error("Called move before initialisation finished.");if(this.gameIsOver)throw new Error("Invalid move: Game is over.");this.engine&&this.engine.isSearching()&&this.engine.stopSearch();const o=this.chessJS.move(n),t=R._cjsMoveToMove(o);this.cg.move(t.from,t.to),this.cg.set({turnColor:R._colorToCgColor(this.chessJS.turn())}),this._postMoveAdmin(t)}moveLan(n){const o=n.slice(0,2),t=n.slice(2,4),i=n.charAt(4)||void 0;this.move({from:o,to:t,promotion:i})}_postMoveAdmin(n){const o=this._enginePlaysNextMove();(n.flags.includes("e")||n.flags.includes("p"))&&this.cg.set({fen:this.chessJS.fen()}),n.check&&this.cg.set({check:!0}),this.moveCallback(n),this._checkForGameOver(),o?this.cg.set({movable:{dests:new Map}}):this._updateChessgroundWithPossibleMoves(),this.stateChangeCallback(this),!this.gameIsOver&&o&&this.playEngineMove()}async playEngineMove(){if(!this.engine)throw new Error("playEngineMove called without initialised engine");return this.engine.getMove(this.chessJS.fen()).then(n=>{this.moveLan(n)})}_enginePlaysNextMove(){return this.engine&&(this.engine.getColor()==="both"||this.engine.getColor()===this.chessJS.turn())}_updateChessgroundWithPossibleMoves(){const n=R._colorToCgColor(this.chessJS.turn());this.cg.set({turnColor:n,movable:{color:n,dests:this.possibleMovesDests()}})}_checkForGameOver(){if(this.chessJS.isCheckmate()){const n=this.chessJS.turn()=="w"?0:1;this.gameOverCallback({reason:"checkmate",result:n}),this.gameIsOver=!0}else this.chessJS.isStalemate()?(this.gameOverCallback({reason:"stalemate",result:.5}),this.gameIsOver=!0):this.chessJS.isInsufficientMaterial()?(this.gameOverCallback({reason:"insufficient material",result:.5}),this.gameIsOver=!0):this.chessJS.isThreefoldRepetition()?(this.gameOverCallback({reason:"repetition",result:.5}),this.gameIsOver=!0):this.chessJS.isDraw()?(this.gameOverCallback({reason:"fifty-move rule",result:.5}),this.gameIsOver=!0):this.gameIsOver=!1}possibleMovesDests(){const n=new Map;return this.gameIsOver||Un.forEach(o=>{const t=this.chessJS.moves({square:o,verbose:!0});t.length&&n.set(o,t.map(i=>i.to))}),n}reset(){this.load("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1")}undo(){const n=this.chessJS.undo(),o=n?R._cjsMoveToMove(n):null,t=R._colorToCgColor(this.chessJS.turn());return this.cg.set({fen:this.chessJS.fen(),check:this.chessJS.inCheck()?t:void 0,turnColor:t,lastMove:void 0}),this.gameIsOver=!1,this._updateChessgroundWithPossibleMoves(),this.stateChangeCallback(this),o}toggleOrientation(){this._orientation=this._orientation==="w"?"b":"w",this.cg.set({orientation:R._colorToCgColor(this._orientation)}),this.stateChangeCallback(this)}orientation(){return this._orientation}isGameOver(){return this.gameIsOver}fen(){return this.chessJS.fen()}turn(){return this.chessJS.turn()}moveNumber(){return this.chessJS.moveNumber()}inCheck(){return this.chessJS.inCheck()}history({verbose:n=!1}={}){return n?this.chessJS.history({verbose:n}).map(R._cjsMoveToMove):this.chessJS.history({verbose:n})}board(){return this.chessJS.board()}static _colorToCgColor(n){return n==="w"?"white":"black"}static _cgColorToColor(n){return n==="white"?"w":"b"}static _cjsMoveToMove(n){const o=n.san.slice(-1),t=o==="#";return{...n,check:o==="+"||t,checkmate:t}}}var sn;(function(e){e.Uninitialised="uninitialised",e.Initialising="initialising",e.Waiting="waiting",e.Searching="searching"})(sn||(sn={}));var Pt=he('<div style="position:relative;"><!></div>');function Nt(e,n){Te(n,!1);const o=Wn();let t=ye(),i=ye(),r=y(n,"moveNumber",12,0),s=y(n,"turn",12,"w"),c=y(n,"inCheck",12,!1),a=y(n,"history",28,()=>[]),l=y(n,"isGameOver",12,!1),f=y(n,"fen",12,"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),d=y(n,"orientation",12,"w"),C=y(n,"engine",24,()=>{}),m=y(n,"class",24,()=>{}),h;function u(b){if(!h)throw new Error("component not mounted yet");h.load(b)}function g(b){if(!h)throw new Error("component not mounted yet");h.move(b)}function M({verbose:b=!1}={}){if(!h)throw new Error("component not mounted yet");return h.history({verbose:b})}function p(){if(!h)throw new Error("component not mounted yet");return h.board()}function v(){if(!h)throw new Error("component not mounted yet");return h.undo()}function D(){if(!h)throw new Error("component not mounted yet");h.reset()}function _(){if(!h)throw new Error("component not mounted yet");h.toggleOrientation()}async function W(){if(!h)throw new Error("component not mounted yet");return h.playEngineMove()}function z(b){f(b.fen()),d(b.orientation()),r(b.moveNumber()),s(b.turn()),c(b.inCheck()),a(b.history()),l(b.isGameOver())}function k(b){return new Promise(se=>{const ce=new kt({target:I(i),props:{square:b,orientation:d(),callback:le=>{ce.$destroy(),se(le)}}})})}function L(b){o("move",b)}function x(b){o("gameOver",b)}cn(async()=>{C()&&C().setUciCallback(b=>o("uci",b)),h=new R(I(t),f(),z,k,L,x,d(),C()),h.init().then(()=>{o("ready")})});var T={load:u,move:g,getHistory:M,getBoard:p,undo:v,reset:D,toggleOrientation:_,playEngineMove:W};xe();var J=Pt(),re=ln(J);return ke(wt(re,{get class(){return m()},$$legacy:!0}),b=>be(t,b),()=>I(t)),Ce(J),ke(J,b=>be(i,b),()=>I(i)),ae(e,J),w(n,"load",u),w(n,"move",g),w(n,"getHistory",M),w(n,"getBoard",p),w(n,"undo",v),w(n,"reset",D),w(n,"toggleOrientation",_),w(n,"playEngineMove",W),qe(T)}export{Nt as Chess};
