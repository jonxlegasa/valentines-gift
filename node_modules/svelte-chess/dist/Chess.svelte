<script context="module">export { Engine } from "./engine.js";
</script>
<script>import { Chessground } from "svelte-chessground";
import PromotionDialog from "./PromotionDialog.svelte";
import { Api } from "./api.js";
import { onMount, createEventDispatcher } from "svelte";
const dispatch = createEventDispatcher();
let chessground;
let container;
export let moveNumber = 0;
export let turn = "w";
export let inCheck = false;
export let history = [];
export let isGameOver = false;
export let fen = "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";
export let orientation = "w";
export let engine = void 0;
let className = void 0;
export { className as class };
let api = void 0;
export function load(newFen) {
  if (!api)
    throw new Error("component not mounted yet");
  api.load(newFen);
}
export function move(moveSan) {
  if (!api)
    throw new Error("component not mounted yet");
  api.move(moveSan);
}
export function getHistory({ verbose = false } = {}) {
  if (!api)
    throw new Error("component not mounted yet");
  return api.history({ verbose });
}
export function getBoard() {
  if (!api)
    throw new Error("component not mounted yet");
  return api.board();
}
export function undo() {
  if (!api)
    throw new Error("component not mounted yet");
  return api.undo();
}
export function reset() {
  if (!api)
    throw new Error("component not mounted yet");
  api.reset();
}
export function toggleOrientation() {
  if (!api)
    throw new Error("component not mounted yet");
  api.toggleOrientation();
}
export async function playEngineMove() {
  if (!api)
    throw new Error("component not mounted yet");
  return api.playEngineMove();
}
function stateChangeCallback(api2) {
  fen = api2.fen();
  orientation = api2.orientation();
  moveNumber = api2.moveNumber();
  turn = api2.turn();
  inCheck = api2.inCheck();
  history = api2.history();
  isGameOver = api2.isGameOver();
}
function promotionCallback(square) {
  return new Promise((resolve) => {
    const element = new PromotionDialog({
      target: container,
      props: {
        square,
        orientation,
        callback: (piece) => {
          element.$destroy();
          resolve(piece);
        }
      }
    });
  });
}
function moveCallback(move2) {
  dispatch("move", move2);
}
function gameOverCallback(gameOver) {
  dispatch("gameOver", gameOver);
}
onMount(async () => {
  if (engine) {
    engine.setUciCallback((message) => dispatch("uci", message));
  }
  api = new Api(chessground, fen, stateChangeCallback, promotionCallback, moveCallback, gameOverCallback, orientation, engine);
  api.init().then(() => {
    dispatch("ready");
  });
});
</script>

<div style="position:relative;" bind:this={container}>
	<Chessground bind:this={chessground} class={className}/>
</div>

